# Gavinho Project Manager - TODO

## Modelo de Dados e Schema
- [x] Definir tabelas de projetos com status, prazos e progresso
- [x] Criar tabela de mapas de quantidades com planejado vs executado
- [x] Definir tabela de e-mails integrados do Outlook
- [x] Criar tabela de encomendas e compras
- [x] Definir tabela de fornecedores com histórico e avaliação
- [x] Criar tabela de tarefas com prioridades e matriz urgência/importância
- [x] Definir tabela de orçamentos com alertas de desvios
- [x] Criar tabela de notificações
- [x] Definir tabela de relatórios e exportações

## Design System e Interface
- [x] Implementar design elegante e sofisticado com paleta de cores profissional
- [x] Configurar tema e tipografia no index.css
- [x] Criar componentes customizados para dashboard
- [x] Implementar layout responsivo com sidebar navigation

## Dashboard Executivo
- [x] Criar visão geral de todos os projetos
- [x] Implementar cards de status de projetos
- [x] Adicionar gráficos de progresso
- [x] Mostrar alertas de prazos e projetos atrasados
- [ ] Implementar filtros e busca de projetos

## Gestão de Projetos
- [x] Criar página de listagem de projetos
- [x] Implementar formulário de criação de projeto
- [x] Adicionar página de detalhes do projeto
- [x] Implementar edição e exclusão de projetos
- [ ] Adicionar timeline e marcos do projeto

## Importação e Análise de Mapas de Quantidades
- [ ] Implementar importação de Google Sheets
- [ ] Implementar importação de Excel
- [ ] Criar visualização de mapas de quantidades
- [ ] Implementar comparação planejado vs executado
- [ ] Adicionar alertas para discrepâncias

## Integração com Outlook
- [ ] Implementar autenticação Microsoft Graph API
- [ ] Criar sincronização de e-mails
- [ ] Implementar classificação automática de e-mails
- [ ] Adicionar busca avançada de e-mails por projeto
- [ ] Criar visualização de histórico de comunicações

## Rastreamento de Encomendas e Compras
- [ ] Criar formulário de registro de encomendas
- [ ] Implementar acompanhamento de status de entrega
- [ ] Adicionar histórico de compras por projeto
- [ ] Criar visualização de custos acumulados

## Gestão de Fornecedores
- [ ] Criar cadastro de fornecedores
- [ ] Implementar histórico de transações
- [ ] Adicionar sistema de avaliação de desempenho
- [ ] Criar relatório de fornecedores

## Sistema de Prioridades
- [ ] Implementar matriz de urgência/importância
- [ ] Criar visualização Kanban
- [ ] Adicionar drag-and-drop para tarefas
- [ ] Implementar atribuição de responsáveis

## Sugestões Inteligentes de IA
- [ ] Integrar OpenAI API para análise de projetos
- [ ] Implementar detecção de projetos atrasados
- [ ] Criar sugestões automáticas de próximas ações
- [ ] Adicionar recomendações de comunicação com fornecedores

## Gestão de Orçamentos
- [ ] Criar formulário de orçamento por projeto
- [ ] Implementar rastreamento de custos reais
- [ ] Adicionar comparação orçado vs realizado
- [ ] Criar alertas de desvios orçamentários
- [ ] Implementar gráficos de evolução de custos

## Sistema de Notificações
- [ ] Implementar notificações de projetos atrasados
- [ ] Adicionar alertas de prazos próximos
- [ ] Criar notificações de encomendas recebidas
- [ ] Implementar lembretes de ações pendentes
- [ ] Adicionar preferências de notificação

## Relatórios e Análises
- [ ] Criar relatórios de progresso de projetos
- [ ] Implementar análise de tendências
- [ ] Adicionar exportação em PDF
- [ ] Adicionar exportação em Excel
- [ ] Criar dashboard de análise de custos
- [ ] Implementar relatórios customizáveis

## Testes e Qualidade
- [x] Escrever testes unitários para procedures críticos
- [ ] Testar fluxos de importação de dados
- [ ] Validar integrações externas
- [ ] Testar responsividade em diferentes dispositivos
- [ ] Validar performance com grande volume de dados

## Integração Microsoft Outlook
- [x] Configurar autenticação Microsoft Graph API
- [x] Implementar sincronização de e-mails do Outlook
- [x] Criar sistema de classificação automática de e-mails (IA)
- [x] Desenvolver interface de visualização de e-mails
- [x] Implementar busca e filtros de e-mails
- [x] Adicionar atribuição de e-mails a projetos
- [x] Criar estatísticas de e-mails por categoria
## Sistema de Sugestões de IA
- [x] Definir tabela de sugestões de IA no schema
- [x] Criar serviço de análise de IA com OpenAI
- [x] Implementar identificação de projetos em risco
- [x] Desenvolver análise de gargalos e atrasos
- [x] Criar sistema de otimização de alocação de recursos
- [x] Implementar sugestões de próximas ações
- [x] Desenvolver análise de padrões históricos
- [x] Criar interface de visualização de sugestões
- [x] Implementar dashboard de riscos
- [x] Adicionar sistema de aceitação/rejeição de sugestões
- [x] Criar testes unitários para sistema de IA

## Módulo de Relatórios Avançados
- [x] Definir tipos de relatórios (progresso, orçamento, recursos, timeline)
- [x] Criar serviço de geração de dados para relatórios
- [x] Implementar análise de tendências e comparações
- [x] Desenvolver geração de gráficos com Recharts
- [x] Implementar exportação para PDF
- [x] Implementar exportação para Excel
- [x] Criar interface de visualização de relatórios
- [x] Adicionar filtros por período e projeto
- [x] Implementar relatórios personalizáveis
- [x] Criar testes unitários para relatórios

## Sistema de Notificações em Tempo Real
- [x] Definir tabela de notificações no schema
- [x] Criar tabela de preferências de notificação por usuário
- [x] Implementar serviço de geração automática de notificações
- [x] Desenvolver monitoramento de alertas críticos de IA
- [x] Implementar monitoramento de prazos próximos
- [x] Criar monitoramento de orçamentos excedidos
- [x] Desenvolver sistema de preferências de notificação
- [x] Criar interface de visualização de notificações
- [x] Implementar painel de configuração de preferências
- [x] Adicionar histórico completo de notificações
- [x] Implementar marcação de lido/não lido
- [x] Criar testes unitários para notificações

## Integração com Google Calendar e Outlook Calendar
- [ ] Configurar autenticação OAuth para Google Calendar
- [ ] Configurar autenticação OAuth para Microsoft Calendar
- [ ] Implementar serviço de sincronização de eventos
- [ ] Criar mapeamento de projetos/tarefas para eventos de calendário
- [ ] Desenvolver sincronização bidirecional (criar, atualizar, deletar)
- [ ] Implementar visualização de calendário na interface
- [ ] Adicionar filtros por projeto, tipo de evento e status
- [ ] Criar sistema de lembretes automáticos por e-mail
- [ ] Implementar configurações de sincronização por usuário
- [x] Adicionar testes unitários para integração de calendários

## Dashboard Avançado de Fornecedores
- [x] Expandir tabela de fornecedores com campos de avaliação
- [x] Criar tabela de transações de fornecedores
- [x] Criar tabela de avaliações de fornecedores
- [x] Implementar serviço de cálculo de KPIs (pontualidade, qualidade, preço médio)
- [x] Desenvolver análise de desempenho por fornecedor
- [x] Criar sistema de ranking de fornecedores
- [x] Implementar dashboard visual com gráficos de desempenho
- [x] Adicionar histórico completo de transações
- [x] Criar sistema de avaliação de fornecedores
- [x] Implementar comparação entre fornecedores
- [x] Adicionar filtros e busca avançada
- [x] Criar testes unitários para dashboard de fornecedores

## Sistema de Análise Preditiva com IA
- [x] Criar tabela de predições no schema
- [x] Implementar serviço de análise preditiva com OpenAI
- [x] Desenvolver algoritmo de previsão de atrasos baseado em histórico
- [x] Criar sistema de estimativa de custos finais
- [x] Implementar análise de padrões históricos de projetos similares
- [x] Desenvolver sistema de recomendações de ajustes no cronograma
- [x] Criar cálculo de probabilidade de atraso
- [x] Implementar análise de fatores de risco (orçamento, recursos, complexidade)
- [x] Desenvolver dashboard de predições com visualizações
- [x] Criar interface de visualização de tendências e projeções
- [x] Implementar alertas de risco alto
- [ ] Adicionar testes unitários para sistema preditivo

## Sistema de Simulação What-If
- [x] Criar tabela de cenários de simulação no schema
- [x] Definir parâmetros ajustáveis (orçamento, equipe, prazos, recursos)
- [x] Implementar serviço de simulação what-if com IA
- [x] Desenvolver cálculo de impacto em prazos
- [x] Criar cálculo de impacto em custos
- [x] Implementar análise de viabilidade de cenários
- [x] Desenvolver comparação lado a lado de múltiplos cenários
- [x] Criar visualizações de impacto (gráficos comparativos)
- [x] Implementar interface interativa com sliders e inputs
- [x] Adicionar salvamento de cenários favoritos
- [x] Criar exportação de análise de cenários
- [x] Adicionar testes unitários para simulações

## Integração de Análise Preditiva com What-If
- [x] Expandir schema de cenários com probabilidade de sucesso
- [x] Adicionar campos de fatores críticos e análise de risco
- [x] Implementar cálculo de probabilidade de sucesso com IA
- [x] Desenvolver análise de fatores críticos por cenário
- [x] Criar sistema de pontuação de risco integrado
- [x] Integrar predições aos resultados de simulação
- [x] Atualizar interface com visualização de probabilidades
- [x] Adicionar gráficos de distribuição de risco
- [x] Implementar comparação de probabilidades entre cenários
- [x] Criar recomendações de mitigação baseadas em probabilidade
- [x] Adicionar testes unitários para integração

## Sistema de Compartilhamento de Cenários What-If
- [x] Criar tabela de compartilhamentos no schema
- [x] Adicionar tabela de comentários de cenários
- [x] Definir níveis de permissão (visualizar, editar, admin)
- [x] Implementar serviço de compartilhamento de cenários
- [x] Desenvolver sistema de convites para membros da equipe
- [x] Criar sistema de comentários e discussões
- [x] Implementar notificações de compartilhamento
- [x] Desenvolver interface de gestão de favoritos
- [x] Criar modal de compartilhamento com seleção de usuários
- [x] Implementar lista de cenários compartilhados comigo
- [x] Adicionar histórico de alterações em cenários compartilhados
- [x] Criar testes unitários para compartilhamento

## Feed de Atividades Recentes
- [x] Criar tabela de atividades no schema
- [x] Definir tipos de atividades (comentário, compartilhamento, edição, criação)
- [x] Implementar serviço de rastreamento automático de atividades
- [x] Desenvolver sistema de agregação de atividades por usuário
- [x] Criar sistema de filtragem por tipo e data
- [x] Implementar timeline visual de atividades
- [x] Adicionar integração com notificações
- [x] Desenvolver interface de feed com cards de atividades
- [x] Implementar paginação e carregamento incremental
- [x] Adicionar links diretos para cenários mencionados
- [x] Criar testes unitários para feed de atividades

## Sistema de Threads de Discussão
- [x] Expandir schema de comentários com parentCommentId para threads
- [x] Adicionar campo de contagem de respostas
- [x] Implementar serviço de gerenciamento de threads aninhadas
- [x] Desenvolver carregamento recursivo de threads
- [x] Criar interface de visualização hierárquica de comentários
- [x] Implementar botão "Responder" em cada comentário
- [x] Adicionar indicadores visuais de nível de aninhamento
- [x] Criar notificações automáticas quando alguém responde
- [x] Implementar colapsar/expandir threads
- [x] Adicionar testes unitários para sistema de threads

## Sistema de @Menções em Comentários
- [x] Criar tabela de menções no schema do banco de dados
- [x] Implementar serviço de parsing de menções (@username)
- [x] Criar router tRPC para buscar usuários disponíveis
- [x] Desenvolver componente de input com autocompletar
- [x] Implementar destaque visual de menções no texto
- [x] Criar notificações automáticas para usuários mencionados
- [x] Adicionar lista de usuários mencionados em cada comentário
- [x] Implementar testes unitários para sistema de menções

## Página de Visualização de Menções
- [x] Criar página Mentions.tsx com lista de menções recebidas
- [x] Implementar filtros de lidas/não lidas
- [x] Adicionar informações contextuais (autor, comentário, cenário)
- [x] Implementar ação de marcar como lido
- [x] Adicionar navegação para o cenário mencionado
- [x] Adicionar rota no App.tsx
- [x] Adicionar link na navegação do DashboardLayout
- [x] Adicionar badge de contagem de menções não lidas no menu

## Ação em Massa para Marcar Menções como Lidas
- [x] Adicionar endpoint tRPC markAllMentionsAsRead
- [x] Adicionar botão "Marcar todas como lidas" na página de Menções
- [x] Implementar confirmação antes de executar ação em massa
- [x] Adicionar feedback visual (toast) após marcar todas
- [x] Atualizar contadores e lista após ação

## Identidade Visual GAVINHO
- [x] Atualizar paleta de cores no index.css (Sandy Beach, Blush, Brown, Gold)
- [x] Adicionar tipografia Cormorant Garamond para títulos
- [x] Ajustar componentes para estilo minimalista/editorial
- [x] Atualizar DashboardLayout com novo design
- [ ] Atualizar cards de alertas e menções
- [ ] Testar responsividade em mobile

## Correção de Erro - Tabela Notifications
- [x] Criar tabela notifications no banco de dados
- [x] Verificar schema da tabela no drizzle/schema.ts
- [x] Testar query de notificações não lidas

## Correção de Tipo Boolean em Notifications
- [x] Encontrar query que usa isRead = 0 ao invés de false
- [x] Corrigir para usar boolean corretamente
- [x] Testar query de notificações não lidas

## Correção de Incompatibilidade Boolean/TINYINT
- [x] Verificar tipo real da coluna isRead no banco (TINYINT vs BOOLEAN)
- [x] Reverter queries para usar 0/1 ao invés de false/true
- [x] Atualizar schema Drizzle para usar int ao invés de boolean
- [x] Testar query de notificações não lidas

## Módulo de Projetos - Fase 1
- [x] Criar schema do banco de dados (projects, project_phases, project_milestones)
- [x] Aplicar migrations no banco de dados
- [ ] Criar backend APIs (tRPC) para CRUD de projetos
- [ ] Criar backend APIs para gestão de fases e milestones
- [ ] Criar página de lista de projetos com filtros
- [ ] Criar ficha completa do projeto com todas as informações
- [ ] Criar componente de timeline visual (Gantt simplificado)
- [ ] Criar componente de gestão de fases configuráveis
- [ ] Adicionar galeria de imagens do projeto
- [ ] Testar funcionalidade completa

## Ficha Completa de Projeto
- [x] Atualizar schema Drizzle com definições de projects, phases e milestones
- [x] Criar server/projectsDb.ts com funções de acesso ao banco
- [x] Criar backend APIs (tRPC) para CRUD de projetos
- [x] Criar página Projects.tsx com lista e filtros
- [x] Criar página ProjectDetails.tsx com tabs
- [x] Implementar tab Overview (briefing, objetivos, KPIs)
- [x] Implementar tab Timeline com fases e milestones
- [x] Implementar tab Equipa com membros e fun- [x] Implementar tab Documentos com upload de PDFs
- [x] Implementar tab Galeria com upload de imagensentar tab Financeiro com orçamento vs real
- [ ] Criar componente ProjectTimeline.tsx (Gantt visual)
- [x] Adicionar rota no App.tsx
- [ ] Adicionar link no DashboardLayout
- [ ] Testar CRUD completo


## Tab Equipa - Implementação
- [x] Criar interface de gestão de equipa com cards de membros
- [x] Implementar formulário de adicionar membro com seleção de função
- [x] Adicionar funções predefinidas (Arquiteto, Engenheiro, Gestor, Empreiteiro, Designer, Consultor)
- [x] Implementar remoção de membros
- [x] Criar visualização de responsabilidades por fase
- [x] Adicionar filtros por função
- [x] Aplicar design GAVINHO
- [x] Testar CRUD completo de equipa


## Drag & Drop para Reordenar Membros da Equipa
- [x] Adicionar campo displayOrder à tabela projectTeam
- [x] Instalar biblioteca @hello-pangea/dnd (fork mantido do react-beautiful-dnd)
- [x] Implementar DragDropContext no Tab Equipa
- [x] Adicionar Droppable e Draggable aos cards de membros
- [x] Criar API tRPC para atualizar ordem dos membros
- [x] Implementar lógica de reordenação no frontend
- [x] Adicionar feedback visual durante arrasto
- [x] Testar funcionalidade completa


## Tab Documentos - Implementação
- [x] Criar interface de upload de documentos com drag & drop
- [x] Implementar upload para S3 via storagePut
- [x] Adicionar categorias (Contratos, Plantas, Licenças, Faturas)
- [x] Criar preview inline de PDFs com iframe
- [x] Implementar download de documentos
- [x] Adicionar filtros por categoria e data
- [x] Criar lista de documentos com cards elegantes
- [x] Aplicar design GAVINHO
- [x] Testar upload e download completo

## Tab Galeria - Implementação
- [x] Instalar biblioteca react-image-lightbox ou similar
- [x] Criar interface de upload múltiplo de imagens
- [x] Implementar upload para S3 via storagePut
- [x] Organizar imagens por fase do projeto
- [x] Criar grid responsivo com lazy loading
- [x] Implementar lightbox para visualização ampliada
- [x] Adicionar legendas e datas às imagens
- [x] Aplicar design GAVINHO com hover effects
- [x] Testar upload múltiplo e lightbox


## Modal Novo Projeto - Implementação
- [x] Criar componente NewProjectModal.tsx
- [x] Adicionar formulário com todos os campos (nome, cliente, localização, datas, orçamento, prioridade, status, descrição)
- [x] Implementar validação de campos obrigatórios
- [x] Adicionar validação de datas (fim > início)
- [x] Adicionar validação de orçamento (valor positivo)
- [x] Integrar com API tRPC projects.create
- [x] Implementar redirecionamento automático para ficha do projeto
- [x] Adicionar loading states e toast notifications
- [x] Substituir botão "+ Novo Projeto" no Dashboard e Projects
- [x] Aplicar design GAVINHO
- [x] Testar fluxo completo de criação


## Seed de Projetos GAVINHO Reais
- [x] Criar script seed-gavinho-projects.mjs com 15 projetos reais
- [x] Adicionar informações realistas (clientes, localizações, datas, orçamentos)
- [x] Executar script para popular banco de dados
- [x] Verificar dados no dashboard


## Seed de Fases GAVINHO Reais
- [x] Analisar PDF com checklist de fases de projeto tipo
- [x] Criar script seed-gavinho-phases.mjs com 3 fases principais
- [x] Adicionar subfases/marcos realistas para cada fase
- [x] Executar script para popular fases nos 17 projetos
- [x] Verificar Timeline com fases no frontend


## Atualização Projeto GA00469_MYRIAD com Dados Reais
- [x] Extrair fases, entregáveis e prazos do PDF 469_MYRIAD_ESCOPO
- [x] Documentar condições de pagamento (8 fases de pagamento)
- [x] Criar script update-myriad-project.mjs com dados reais
- [x] Atualizar fases do projeto com prazos corretos (8 fases, 470 dias úteis)
- [x] Adicionar marcos detalhados por fase (29 marcos totais)
- [x] Verificar atualização no Tab Timeline


## Popular Documentos do Projeto MYRIAD
- [x] Criar script seed-myriad-documents.mjs
- [x] Adicionar documentos da Fase 1 - Estudo Prévio (7 documentos: moodboards, layouts, 4 renders 3D)
- [x] Adicionar documentos da Fase 2 - Projeto Base (10 documentos: plantas, desenhos técnicos, 5 renders 3D)
- [x] Adicionar documentos da Fase 3.1 - Obra Acabamentos (9 documentos: mapas, cadernos de encargos, pormenorização)
- [x] Adicionar documentos da Fase 3.2 - Decoração e Mobiliário (7 documentos: FF&E, renders promocionais)
- [x] Adicionar documentos da Fase 3.3 - Bom Para Construção (6 documentos: compatibilização, modelo BIM)
- [x] Executar script e verificar Tab Documentos (39 documentos totais)


## Reestruturação de Tabs da Ficha de Projeto
- [x] Renomear "Overview" para "Dashboard"
- [x] Renomear "Timeline" para "Fases & Entregas" e criar 3 sub-tabs (Fases, Entregáveis, Central de Entregas)
- [x] Renomear "Documentos" para "Design Review"
- [x] Renomear "Galeria" para "Briefing" e criar 2 sub-tabs (Galeria, Memória Conceptual)
- [x] Criar tab "Archiviz" (novo)
- [x] Manter tab "Equipa" como está
- [x] Manter tab "Financeiro" (placeholder)
- [x] Atualizar navegação e ordem dos tabs
- [x] Testar navegação completa


## Central de Entregas - Implementação
- [x] Criar tabela projectDeliveries no schema
- [x] Criar tabela deliveryApprovals para histórico de aprovações
- [x] Implementar APIs tRPC para CRUD de entregas
- [x] Implementar APIs tRPC para aprovações/rejeições
- [x] Criar componente DeliveryTimeline com visualização de próximas entregas
- [x] Implementar upload de documentos de entrega
- [x] Criar sistema de notificações automáticas (3 dias antes)
- [x] Implementar filtros por status, fase e tipo
- [x] Criar dashboard de métricas (no prazo, atrasadas, aprovadas)
- [x] Adicionar histórico de aprovações/rejeições com comentários
- [x] Aplicar design GAVINHO
- [x] Testar fluxo completo de entrega e aprovação


## Módulo de Obras (GB) - Implementação
- [x] Analisar estrutura completa do MQT (26 páginas do PDF GA00466-PENTHOUSESI)
- [x] Criar tabela `constructions` (obras GB) associada a projetos
- [x] Criar tabela `mqtCategories` (categorias do MQT)
- [x] Criar tabela `mqtItems` (itens individuais do MQT com descrição PT+EN)
- [x] Criar relação Projeto (GA) ↔ Obra (GB)
- [x] Implementar server/constructionsDb.ts com funções de acesso ao banco
- [x] Implementar server/constructionsRouter.ts com APIs tRPC para CRUD de obras
- [x] Implementar APIs tRPC para gestão de MQT (categorias e itens)
- [x] Criar página Constructions.tsx para listagem de obras
- [x] Criar página ConstructionDetails.tsx com tabs (Dashboard, MQT, Fornecedores, Custos, Timeline)
- [x] Adicionar menu "Obras" no DashboardLayout
- [x] Popular 5 obras em curso:
  - [x] GB00433_Ourique
  - [x] GB00402_Maria Residences
  - [x] GB00462_Restelo
  - [x] GB00464_Apartment IG
  - [x] GA00466_Penthouse SI
- [x] Importar MQT da GB00466_Penthouse SI (18 itens: 13 Demolições + 5 Paredes Interiores)
- [ ] Implementar toggle "Mostrar EN" para descrições em inglês no MQT
- [ ] Extrair e importar restantes ~180+ itens do MQT (páginas 6-26 do PDF)
- [ ] Criar dashboard de custos (orçado vs real) no tab Custos
- [ ] Implementar gestão de fornecedores por item MQT
- [x] Testar módulo completo


## Toggle "Mostrar EN" no MQT
- [x] Adicionar estado showEnglish no componente ConstructionDetails
- [x] Criar botão toggle com ícone Languages no cabeçalho do tab MQT
- [x] Adicionar coluna Description (EN) à tabela MQT
- [x] Implementar lógica de ocultar/mostrar coluna EN baseado no estado
- [x] Adicionar animação suave na transição (React renderização condicional)
- [x] Aplicar design GAVINHO ao botão toggle (cores #C9A882 quando ativo)
- [x] Testar funcionalidade


## Extrair e Importar MQT Completo do PDF
- [ ] Processar todas as 26 páginas do PDF GA00466-PENTHOUSESI
- [ ] Extrair ~200+ itens com estrutura completa (Item, Tipo, Subtipo, Zona, Descrição PT/EN, UN, QT)
- [ ] Identificar e mapear todas as categorias do MQT
- [ ] Criar script de seed para popular banco de dados
- [ ] Executar script e validar dados
- [ ] Verificar tabela MQT completa no frontend

## Filtros e Pesquisa no MQT
- [x] Adicionar barra de pesquisa na tabela MQT (busca por código, tipo, zona, descrição PT/EN)
- [x] Adicionar filtro dropdown por categoria
- [x] Adicionar contador de resultados filtrados
- [x] Adicionar botão "Limpar Filtros"
- [x] Implementar lógica de filtro combinado (pesquisa + categoria)

## Agrupamento por Categoria no MQT
- [x] Adicionar estado de categorias expandidas/colapsadas
- [x] Criar headers de categoria clicáveis com ícone expand/collapse
- [x] Agrupar itens por categoria na renderização
- [x] Calcular subtotais por categoria (quantidade total)
- [x] Adicionar visual hierárquico (indentação, cores)
- [x] Implementar animação suave de expand/collapse

## Comparação Visual Planejado vs Executado no MQT
- [ ] Adicionar campo quantityExecuted (DECIMAL) ao schema mqtItems
- [ ] Executar db:push para migrar banco de dados
- [ ] Criar mutation updateItemQuantityExecuted no tRPC
- [ ] Renomear coluna "QT" para "QT Planejado" no frontend
- [ ] Adicionar coluna "QT Executado" com edição inline
- [ ] Adicionar coluna "Progresso" com barra visual
- [ ] Implementar lógica de cores (verde: 90-110%, amarelo: 80-90%/110-120%, vermelho: <80%/>120%)
- [ ] Atualizar subtotais para incluir total executado e % médio por categoria
- [ ] Adicionar tooltip com detalhes ao passar mouse na barra de progresso
- [ ] Testar edição inline e atualização de progresso
## Filtros e Pesquisa no MQT
- [x] Adicionar barra de pesquisa na tabela MQT (busca por código, tipo, zona, descrição PT/EN)
- [x] Adicionar filtro dropdown por categoria
- [x] Adicionar contador de resultados filtrados
- [x] Adicionar botão "Limpar Filtros"
- [x] Implementar lógica de filtro combinado (pesquisa + categoria)

## Agrupamento por Categoria no MQT
- [x] Adicionar estado de categorias expandidas/colapsadas
- [x] Criar headers de categoria clicáveis com ícone expand/collapse
- [x] Agrupar itens por categoria na renderização
- [x] Calcular subtotais por categoria (quantidade total)
- [x] Adicionar visual hierárquico (indentação, cores)
- [x] Implementar animação suave de expand/collapse
## Comparação Planejado vs Executado no MQT
- [x] Adicionar campo quantityExecuted ao schema mqtItems
- [x] Migrar banco de dados com novo campo
- [x] Criar mutation tRPC updateQuantityExecuted
- [x] Adicionar função updateMqtItemQuantityExecuted no constructionsDb
- [x] Renomear coluna QT para QT Planejado
- [x] Adicionar coluna QT Executado com input editável
- [x] Adicionar coluna Progresso com barra visual
- [x] Implementar lógica de cores (verde 90-110%, amarelo 80-90%/110-120%, vermelho <80%/>120%)
- [x] Atualizar subtotais para incluir totalExecuted e averageProgress
- [x] Testar edição inline e atualização em tempo real
- [x] Verificar persistência no banco de dados

## Histórico de Alterações no MQT
- [x] Criar tabela mqtItemHistory no schema (itemId, userId, oldValue, newValue, changedAt)
- [x] Migrar banco de dados com nova tabela
- [x] Adicionar função createMqtItemHistoryEntry no constructionsDb
- [x] Integrar registro de histórico na mutation updateQuantityExecuted
- [x] Criar query tRPC para buscar histórico por itemId
- [x] Criar componente Modal de histórico com timeline
- [x] Adicionar botão de ícone de histórico em cada linha da tabela MQT
- [x] Implementar indicador visual de número de alterações
- [x] Adicionar filtros por data e utilizador no modal
- [x] Testar registro e visualização de histórico completo

## Dashboard de Análise de Alterações MQT
- [ ] Criar queries tRPC para estatísticas agregadas (total alterações, por período, por utilizador)
- [ ] Criar query para itens mais editados (top 10)
- [ ] Criar query para utilizadores mais ativos
- [ ] Criar query para análise de desvios críticos
- [ ] Criar query para timeline de atividade
- [ ] Criar página MqtAnalyticsDashboard.tsx
- [ ] Implementar cards de métricas principais (total, 24h, 7d, 30d)
- [ ] Adicionar gráfico de barras para itens mais editados
- [ ] Adicionar gráfico de pizza para utilizadores ativos
- [ ] Implementar lista de itens com desvios críticos
- [ ] Adicionar gráfico de linha para timeline de atividade
- [ ] Integrar dashboard no menu de navegação principal
- [ ] Testar todas as visualizações e métricas

## Funcionalidade de Apagar Projetos
- [ ] Criar mutation tRPC deleteProject no projectsRouter
- [ ] Implementar função deleteProject no projectsDb com deleção em cascata
- [ ] Adicionar botão "Apagar Projeto" na página de detalhes do projeto
- [ ] Criar modal de confirmação com avisos sobre dados relacionados
- [ ] Testar deleção de projeto com dados mockados

## Funcionalidade de Apagar Projetos
- [ ] Criar mutation tRPC deleteProject no projectsRouter
- [ ] Implementar função deleteProject no projectsDb com deleção em cascata
- [ ] Adicionar botão "Apagar Projeto" na página de detalhes do projeto
- [ ] Criar modal de confirmação com avisos sobre dados relacionados
- [ ] Testar deleção de projeto com dados mockados

## Soft Delete com Lixeira
- [ ] Adicionar campo deletedAt (timestamp nullable) às tabelas projects e constructions
- [ ] Atualizar queries para filtrar registos com deletedAt IS NULL por padrão
- [ ] Modificar mutation delete para fazer soft delete (SET deletedAt = NOW())
- [ ] Criar query listTrash para listar itens apagados (deletedAt IS NOT NULL)
- [ ] Criar mutation restore para recuperar itens (SET deletedAt = NULL)
- [x] Criar mutation permanentDelete para apagar definitivamente
- [x] Criar página Trash.tsx para visualizar lixeira
- [x] Adicionar botões Restaurar e Apagar Permanentemente
- [ ] Adicionar link "Lixeira" no menu de navegação
- [ ] Adicionar badge com contador de itens na lixeira
- [ ] Testar soft delete, restauração e deleção permanente

## Deleção de Obras
- [x] Adicionar botão Apagar na página ConstructionDetails
- [x] Criar modal de confirmação de deleção de obra
- [ ] Implementar contagem de dados relacionados (MQT, categorias, histórico)
- [ ] Testar soft delete de obra
- [ ] Testar restauração de obra da lixeira
- [ ] Verificar que obra restaurada volta para lista principal

## Módulo ArchViz (Visualizações 3D / Renders)
- [ ] Criar tabela archvizCompartments (compartimentos/ambientes)
- [ ] Criar tabela archvizRenders (renders com versionamento)
- [ ] Criar tabela archvizComments (comentários por render)
- [ ] Implementar upload de renders para S3
- [ ] Criar sistema de organização hierárquica (compartimentos > sub-compartimentos)
- [ ] Implementar versionamento automático de renders
- [ ] Adicionar sistema de favoritos
- [ ] Implementar download de renders
- [ ] Criar sistema de comentários por render
- [ ] Desenvolver galeria visual com thumbnails
- [ ] Adicionar contador de imagens por compartimento
- [ ] Implementar expand/collapse de compartimentos
- [ ] Criar tab ArchViz na página de detalhes da obra
- [ ] Adicionar modal de visualização fullscreen
- [ ] Implementar comparação lado a lado de versões

## ArchViz - Funcionalidades Essenciais
- [ ] Adicionar campo status ao schema archvizRenders (pending, approved_dc, approved_client)
- [ ] Atualizar mutation updateRender para suportar mudança de status
- [ ] Atualizar mutation updateRender para suportar mudança de compartimento
- [ ] Criar componente ArchVizUpload com drag & drop
- [ ] Implementar upload múltiplo de imagens
- [ ] Criar modal de edição de render (nome, descrição, compartimento, status)
- [ ] Implementar galeria com cards destacados para aprovados (fundo escuro)
- [ ] Adicionar badges de status nos cards (Pendente, Aprovada DC, Aprovada DC + Cliente)
- [ ] Integrar todos os componentes no tab ArchViz do ConstructionDetails

## ArchViz - Comparação de Versões
- [ ] Criar componente RenderComparisonModal
- [ ] Implementar slider interativo para revelar diferenças
- [ ] Adicionar zoom sincronizado em ambas as imagens
- [ ] Criar modo de seleção de renders para comparação
- [ ] Adicionar botão "Comparar" na galeria
- [ ] Mostrar detalhes comparativos (data, status, descrição) de ambas as versões
- [ ] Implementar navegação entre pares de comparação

## ArchViz - Sistema de Filtros
- [x] Adicionar filtro por status (Pendente/Aprovada DC/Aprovada DC + Cliente)
- [x] Adicionar filtro por compartimento (dropdown com todos os compartimentos)
- [x] Adicionar filtro por período de upload (Última semana/Último mês/Últimos 3 meses/Todos)
- [x] Adicionar toggle de favoritos
- [x] Adicionar barra de pesquisa por nome/descrição
- [x] Implementar lógica de filtros combinados
- [x] Adicionar contador de resultados ("A mostrar X de Y renders")
- [x] Adicionar botão "Limpar Filtros"
- [x] Criar interface elegante com design GAVINHO


## ArchViz - Histórico de Aprovações
- [x] Criar tabela archviz_status_history no schema
- [x] Adicionar campos: renderId, oldStatus, newStatus, changedBy (userId), changedAt, notes
- [x] Implementar trigger automático para registar mudanças de status
- [x] Criar query getStatusHistory(renderId) no archvizDb
- [x] Criar procedure archviz.getStatusHistory no router
- [x] Criar componente StatusHistoryModal com timeline visual
- [x] Adicionar ícones diferentes por tipo de mudança (pending, approved_dc, approved_client)
- [x] Mostrar nome do utilizador que aprovou
- [x] Adicionar data/hora formatada de cada mudança
- [x] Integrar botão "Ver Histórico" nos cards de render
- [x] Adicionar animações de transição na timeline
- [x] Criar design elegante com cores GAVINHO


## ArchViz - Notificações Automáticas
- [x] Integrar notifyOwner() na mutation updateRender
- [x] Criar mensagem de notificação com detalhes da mudança (obra, render, status anterior → novo)
- [x] Incluir nome do utilizador que fez a mudança
- [x] Adicionar link direto para a obra/render na notificação
- [x] Testar notificações com mudanças de status reais
- [x] Verificar se notificações aparecem no painel do owner


## ArchViz - Exportação de Relatório PDF
- [x] Instalar dependências jsPDF e jspdf-autotable
- [x] Criar serviço de geração de PDF no frontend
- [x] Criar endpoint backend para buscar dados completos (renders + histórico + comentários)
- [x] Implementar estrutura do relatório PDF (cabeçalho, informações da obra, estatísticas)
- [x] Adicionar lista de renders com miniaturas no PDF
- [x] Incluir histórico de aprovações de cada render
- [x] Adicionar comentários associados a cada render
- [x] Implementar botão "Exportar Relatório PDF" na galeria ArchViz
- [x] Adicionar loading state durante geração do PDF
- [x] Testar exportação com obra completa


## ArchViz - Upload em Lote com Drag & Drop
- [x] Criar componente BulkUploadModal com área de drag & drop
- [x] Implementar validação de tipo de arquivo (apenas imagens: jpg, png, webp)
- [x] Implementar validação de tamanho máximo (ex: 10MB por arquivo)
- [x] Adicionar preview de miniaturas dos arquivos selecionados
- [x] Criar formulário para atribuir compartimento, versão e descrição em lote
- [x] Implementar upload simultâneo de múltiplos arquivos para S3
- [x] Adicionar barra de progresso individual para cada arquivo
- [x] Mostrar status de sucesso/erro para cada upload
- [x] Criar endpoint backend para processar uploads em lote
- [x] Integrar botão "Upload em Lote" no ArchVizGallery
- [x] Adicionar feedback visual durante drag over
- [x] Testar upload de múltiplos arquivos simultaneamente


## MQT - Importação Automática
- [x] Instalar dependências (xlsx, google-spreadsheet)
- [x] Criar serviço de importação de Excel (.xlsx, .xls)
- [x] Implementar parser de colunas do Excel
- [x] Criar serviço de importação de Google Sheets
- [x] Implementar autenticação OAuth para Google Sheets
- [x] Criar sistema de validação de estrutura (colunas obrigatórias)
- [x] Implementar detecção de discrepâncias (duplicados, valores inválidos, campos vazios)
- [x] Criar componente MQTImportModal com upload de arquivo
- [x] Adicionar input para URL do Google Sheets
- [x] Implementar preview dos dados antes de importar
- [x] Criar interface de mapeamento de colunas
- [x] Adicionar alertas visuais para problemas encontrados
- [x] Implementar opção de corrigir/ignorar discrepâncias
- [x] Criar barra de progresso para importação em lote
- [x] Adicionar log de importação com resumo (sucesso/erro/avisos)
- [x] Integrar botão "Importar MQT" na página de obras
- [x] Testar importação de Excel com dados reais
- [x] Testar importação de Google Sheets com dados reais


## MQT - Histórico de Importações
- [x] Criar tabela mqt_import_history no schema
- [x] Adicionar campos: constructionId, userId, source (excel/sheets), fileName, itemsImported, itemsSuccess, itemsError, importedAt
- [x] Criar tabela mqt_import_items para rastrear itens de cada importação
- [x] Atualizar mutation importItems para registar histórico automaticamente
- [x] Criar query getImportHistory(constructionId) no mqtDb
- [x] Criar mutation revertImport(importId) no mqtDb
- [x] Criar procedure mqt.getImportHistory no router
- [x] Criar procedure mqt.revertImport no router
- [x] Criar componente MQTImportHistory com lista de importações
- [x] Adicionar timeline visual com data, utilizador e estatísticas
- [x] Implementar botão "Reverter Importação" com confirmação
- [x] Adicionar filtros por data, utilizador e fonte
- [x] Mostrar detalhes de cada importação (itens, erros, avisos)
- [x] Integrar botão "Ver Histórico" na página MQT
- [x] Adicionar modal ou drawer para mostrar histórico
- [x] Testar reversão de importação


## MQT - Validação Customizável
- [x] Criar tabela mqt_validation_rules no schema
- [x] Adicionar campos: constructionId, ruleType (price_range/code_pattern/quantity_limit/duplicate_tolerance), field, condition, value, severity (error/warning/info), enabled
- [x] Criar serviço de validação customizável no frontend
- [x] Implementar validadores por tipo: preço (min/max), código (regex), quantidade (limites)
- [x] Adicionar validação de duplicados com tolerância configurável
- [x] Criar componente MQTValidationRules para configurar regras
- [x] Adicionar interface de criação/edição de regras
- [x] Implementar preview de regras aplicadas
- [x] Criar procedures CRUD para regras de validação no backend
- [x] Integrar validação customizável no mqtImportService
- [x] Atualizar MQTImportModal para mostrar violações de regras
- [x] Adicionar alertas visuais destacados para violações
- [x] Criar botão "Configurar Validações" na página MQT
- [x] Adicionar regras padrão sugeridas por categoria
- [x] Testar validações com diferentes tipos de regras


## Timeline Visual e Gantt Chart
- [x] Adicionar campo dependencies (array de IDs) à tabela projectMilestones
- [x] Criar índices para queries de timeline otimizadas
- [x] Implementar função getProjectTimeline no projectsDb.ts
- [x] Criar procedure projects.timeline.get no router
- [x] Criar procedure projects.milestones.updateDates para arrastar e soltar
- [x] Criar procedure projects.milestones.updateDependencies
- [x] Instalar biblioteca de Gantt Chart (gantt-task-react ou frappe-gantt)
- [x] Criar componente ProjectGanttChart.tsx
- [x] Implementar visualização de fases como barras horizontais
- [x] Implementar visualização de marcos como diamantes/círculos
- [x] Adicionar escala de tempo (dias/semanas/meses)
- [x] Implementar linha vertical "Hoje"
- [x] Adicionar cores por status (pendente/em andamento/concluído/atrasado)
- [x] Implementar tooltip com detalhes ao passar mouse
- [x] Adicionar funcionalidade de arrastar barras para ajustar datas (via modal de edição)
- [x] Implementar setas de dependência entre marcos
- [x] Adicionar zoom in/out na timeline
- [x] Criar filtros (todas as fases / fase específica)
- [x] Adicionar botão para alternar entre vista Gantt e vista Lista
- [x] Implementar modal de edição rápida ao clicar em fase/marco
- [x] Adicionar indicadores visuais de progresso nas barras
- [x] Criar legenda de cores e símbolos
- [x] Testar arrastar e soltar com diferentes datas
- [x] Testar dependências entre marcos
- [x] Validar cálculo automático de datas críticas (critical path)


## Separador Archviz
- [x] Criar tabela archvizRenders no schema (já existia)
- [x] Criar tabela archvizComments no schema (já existia)
- [x] Criar tabela archvizStatusHistory no schema (já existia)
- [x] Adicionar índices para queries otimizadas
- [x] Implementar função getProjectArchvizRenders no projectsDb.ts (agrega de todas as obras)
- [x] Implementar função getArchvizRenderById no projectsDb.ts
- [x] Implementar função updateArchvizRenderStatus no projectsDb.ts
- [x] Implementar função addArchvizComment no projectsDb.ts
- [x] Implementar função getArchvizComments no projectsDb.ts
- [x] Implementar função getProjectArchvizStats no projectsDb.ts
- [x] Criar procedures archviz.list, archviz.getById, archviz.updateStatus no router
- [x] Criar procedures archviz.addComment, archviz.getComments no router
- [x] Criar procedure archviz.getStats no router
- [x] Criar componente ProjectArchvizGallery.tsx
- [x] Implementar grid de renders com thumbnails
- [x] Criar lightbox para visualização em fullscreen
- [x] Criar filtros por status (Pendente/Aprovado DC/Aprovado Cliente)
- [x] Criar filtros por obra (código GB)
- [x] Implementar alternância entre vista grid e lista
- [x] Implementar botões de aprovação (Pendente/Aprovado DC/Aprovado Cliente)
- [x] Criar área de comentários por render
- [x] Criar painel de estatísticas (total, pendentes, aprovados DC, aprovados cliente, favoritos)
- [x] Implementar download de renders individuais
- [x] Integrar componente no tab Archiviz do ProjectDetails
- [x] Testar aprovações e comentários
- [ ] Upload de renders (funcionalidade das Obras, não do Projeto)
- [ ] Sistema de versionamento (funcionalidade das Obras)
- [ ] Download em lote (ZIP) - melhoria futura


## Upload de Renders no Archviz
- [x] Criar função getProjectConstructions no projectsDb.ts
- [x] Criar função uploadArchvizRender no projectsDb.ts
- [x] Adicionar procedure projects.constructions.list no router
- [x] Adicionar procedure projects.archviz.upload no router
- [x] Adicionar botão "Upload Render" no ProjectArchvizGallery
- [x] Criar modal de upload com formulário completo
- [x] Implementar seleção de obra (dropdown)
- [x] Adicionar campos nome e descrição
- [x] Implementar upload de imagem com preview
- [x] Adicionar validação de formato (JPG, PNG, WebP)
- [x] Adicionar validação de tamanho (máx 20MB)
- [x] Adicionar loading states durante upload
- [x] Implementar refetch após upload bem-sucedido
- [x] Criar endpoint projects.archviz.uploadToS3 para upload direto
- [x] Implementar conversão base64 para Buffer no backend
- [x] Integrar storagePut para enviar imagem ao S3
- [x] Gerar chave única com timestamp e random suffix
- [x] Retornar URL pública do S3
- [x] Atualizar frontend para chamar novo endpoint
- [x] Simplificar fluxo de upload no frontend
- [ ] Testar upload com imagem real
- [ ] Validar que render aparece na galeria com URL do S3


## Seletor de Compartimento no Upload
- [x] Verificar estrutura da tabela compartments no schema
- [x] Criar função getConstructionCompartments no projectsDb.ts
- [x] Criar procedure projects.constructions.getCompartments no router
- [x] Adicionar query para buscar compartimentos no frontend
- [x] Adicionar Select de compartimentos no modal de upload
- [x] Implementar carregamento dinâmico ao selecionar obra
- [x] Atualizar estado uploadData com compartmentId selecionado
- [x] Adicionar validação obrigatória de compartimento
- [x] Atualizar uploadData inicial com compartmentId: 0
- [ ] Testar seleção de compartimento e upload


## Criação Rápida de Compartimentos
- [x] Criar função createCompartment no projectsDb.ts
- [x] Criar procedure projects.constructions.createCompartment no router
- [x] Adicionar botão "+ Novo" ao lado do seletor de compartimentos
- [x] Criar dialog compacto para criação rápida
- [x] Adicionar campos nome (obrigatório) e descrição (opcional)
- [x] Implementar mutation para criar compartimento
- [x] Adicionar refetch automático após criação
- [x] Implementar seleção automática do compartimento recém-criado
- [x] Adicionar loading state no botão de criação
- [ ] Testar criação e seleção automática


## Edição Inline de Compartimentos
- [x] Criar função updateCompartment no projectsDb.ts
- [x] Criar função deleteCompartment no projectsDb.ts
- [x] Criar função checkCompartmentHasRenders no projectsDb.ts
- [x] Criar procedure projects.constructions.updateCompartment no router
- [x] Criar procedure projects.constructions.deleteCompartment no router
- [x] Redesenhar SelectItem para incluir ícones de editar e apagar
- [x] Adicionar state para controlar modo de edição (editingCompartmentId)
- [x] Criar mini-formulário inline com Input para nome
- [x] Adicionar botões de confirmar e cancelar na edição
- [x] Implementar mutation updateCompartment
- [x] Implementar mutation deleteCompartment
- [x] Adicionar dialog de confirmação antes de apagar
- [x] Validar se compartimento tem renders antes de permitir exclusão
- [x] Mostrar mensagem de erro se tentar apagar compartimento com renders
- [x] Adicionar refetch automático após editar ou apagar
- [ ] Testar edição de nome
- [ ] Testar exclusão com e sem renders associados


## Drag & Drop para Reordenar Compartimentos
- [x] Verificar se campo displayOrder existe na tabela archvizCompartments (campo 'order' já existe)
- [x] Criar função reorderCompartments no projectsDb.ts
- [x] Criar procedure projects.constructions.reorderCompartments no router
- [x] Adicionar state draggedCompartment no frontend
- [x] Adicionar state dragOverCompartment no frontend
- [x] Implementar handler onDragStart nos compartimentos
- [x] Implementar handler onDragOver nos compartimentos
- [x] Implementar handler onDrop nos compartimentos
- [x] Implementar handler onDragEnd para limpar states
- [x] Adicionar atributo draggable nos compartimentos (desabilitado durante edição)
- [x] Adicionar indicador visual durante arrasto (opacidade 50%)
- [x] Adicionar indicador visual no drop target (borda dourada)
- [x] Adicionar cursor "grab" ao passar mouse
- [x] Implementar lógica de reordenação local com splice
- [x] Chamar mutation para persistir nova ordem no banco
- [x] Adicionar refetch após reordenação
- [x] Ordenar compartments por 'order' na query
- [ ] Testar drag & drop entre compartimentos


## Portal do Cliente
### Sistema de Roles e Autenticação
- [ ] Adicionar role 'client' à tabela users (se não existir)
- [ ] Criar tabela clientProjects (userId, projectId) para associar clientes a projetos
- [ ] Criar função getClientProjects no projectsDb.ts
- [ ] Criar middleware clientProcedure no tRPC para validar role client
- [ ] Criar procedure portal.auth.me para obter dados do cliente logado

### Backend do Portal
- [ ] Criar função getClientDashboardStats no projectsDb.ts
- [ ] Criar função getClientProjectDetails no projectsDb.ts
- [ ] Criar função getClientArchvizRenders no projectsDb.ts
- [ ] Criar função getClientDocuments no projectsDb.ts
- [ ] Criar procedure portal.dashboard.stats
- [ ] Criar procedure portal.projects.list
- [ ] Criar procedure portal.projects.getById
- [ ] Criar procedure portal.archviz.list
- [ ] Criar procedure portal.archviz.approve
- [ ] Criar procedure portal.archviz.requestRevision
- [ ] Criar procedure portal.documents.list

### Frontend - Dashboard do Cliente
- [ ] Criar rota /portal no App.tsx
- [ ] Criar componente ClientPortalLayout.tsx
- [ ] Criar página ClientDashboard.tsx
- [ ] Implementar cards de estatísticas (projetos ativos, marcos pendentes)
- [ ] Criar lista de projetos do cliente
- [ ] Adicionar seção de notificações recentes
- [ ] Implementar navegação do portal

### Frontend - Projetos e Archviz
- [ ] Criar página ClientProjectDetails.tsx
- [ ] Implementar visualização de fases e progresso
- [ ] Criar timeline de marcos
- [ ] Criar componente ClientArchvizGallery.tsx
- [ ] Implementar galeria de renders com aprovação
- [ ] Adicionar botões Aprovar/Solicitar Revisão
- [ ] Implementar sistema de comentários do cliente
- [ ] Criar lightbox para visualização fullscreen

### Frontend - Documentos
- [ ] Criar página ClientDocuments.tsx
- [ ] Implementar lista de documentos por projeto
- [ ] Adicionar filtros por tipo de documento
- [ ] Implementar download de documentos
- [ ] Mostrar histórico de versões

### Sistema de Mensagens
- [ ] Criar tabela clientMessages (id, projectId, senderId, message, createdAt)
- [ ] Criar função sendClientMessage no projectsDb.ts
- [ ] Criar função getClientMessages no projectsDb.ts
- [ ] Criar procedure portal.messages.send
- [ ] Criar procedure portal.messages.list
- [ ] Criar componente ClientMessaging.tsx
- [ ] Implementar chat em tempo real (polling ou websockets)
- [ ] Adicionar notificações de novas mensagens

### UI/UX do Portal
- [ ] Criar tema visual diferenciado para o portal
- [ ] Implementar navegação simplificada
- [ ] Adicionar breadcrumbs
- [ ] Criar estados vazios user-friendly
- [ ] Implementar loading states
- [ ] Adicionar tooltips explicativos
- [ ] Garantir responsividade mobile

### Testes e Validação
- [ ] Testar login como cliente
- [ ] Validar que cliente vê apenas seus projetos
- [ ] Testar aprovação de renders
- [ ] Testar sistema de mensagens
- [ ] Validar download de documentos
- [ ] Testar em diferentes dispositivos


## Melhorias no Separador Archviz do Projeto
- [ ] Verificar implementação atual do ProjectArchvizGallery
- [ ] Adicionar organização visual por compartimentos (accordion)
- [ ] Implementar agrupamento de versões por render
- [ ] Adicionar indicador de versão (v1, v2, v3...) nas thumbnails
- [ ] Implementar ícone de favorito (estrela) clicável
- [ ] Adicionar ícone de editar render
- [ ] Adicionar ícone de apagar render
- [ ] Melhorar layout das thumbnails (cards com ações)
- [ ] Adicionar contador de imagens e vistas por compartimento
- [ ] Implementar collapse/expand de compartimentos
- [ ] Testar upload de render com interface melhorada
- [ ] Validar organização automática por compartimento

## ArchViz - Galeria com Accordion por Compartimentos
- [x] Redesenhar interface da galeria com organização por compartimentos
- [x] Implementar accordion expansível para cada compartimento
- [x] Adicionar contadores visuais (X imagens em Y vistas)
- [x] Criar agrupamento de versões dentro de cada compartimento
- [x] Adicionar badges de versões (ex: "3 versões")
- [x] Implementar grid responsivo de thumbnails (1/2/3 colunas)
- [x] Adicionar hover effects e overlay com ações
- [x] Corrigir função getProjectArchvizRenders para usar inArray
- [x] Adicionar leftJoin com archvizCompartments para obter nome do compartimento
- [x] Criar estatísticas globais no header (total de imagens, vistas e compartimentos)

## ArchViz - Modal Lightbox de Visualização
- [x] Criar componente RenderLightbox com Dialog do shadcn/ui
- [x] Implementar navegação entre imagens (setas e teclado)
- [x] Adicionar funcionalidade de zoom (botões e scroll do mouse)
- [x] Criar controles de zoom in/out e reset
- [x] Implementar pan/drag quando imagem está com zoom
- [x] Adicionar informações do render (nome, versão, status, data)
- [x] Criar thumbnails de navegação na parte inferior
- [x] Adicionar atalhos de teclado (ESC, setas, +/-, 0)
- [x] Implementar animações suaves de transição
- [x] Integrar lightbox ao clicar em thumbnail na galeria

## ArchViz - Anotações e Markup Visual
- [x] Criar componente RenderAnnotationCanvas com canvas overlay
- [x] Implementar ferramentas de desenho: seta, círculo, retângulo, texto, caneta livre
- [x] Adicionar seletor de cor e espessura de linha
- [x] Criar toolbar de ferramentas no lightbox
- [x] Implementar funcionalidade de desfazer/refazer (undo/redo)
- [x] Adicionar botão para limpar todas as anotações
- [x] Criar schema no banco de dados para salvar anotações (archvizAnnotations)
- [x] Implementar tRPC procedures para salvar/carregar anotações
- [x] Persistir anotações por render e versão
- [x] Carregar anotações existentes ao abrir lightbox (integração tRPC)
- [x] Adicionar botão "Salvar Anotações" no lightbox
- [x] Implementar exportação de render com anotações como imagem
  - [x] Adicionar botão "Exportar" na toolbar de anotações
  - [x] Criar função para combinar imagem original + canvas de anotações
  - [x] Implementar download automático do PNG gerado
  - [x] Adicionar toast de feedback após exportação

## ArchViz - Integração tRPC de Anotações
- [x] Adicionar useQuery para carregar anotações ao abrir lightbox
- [x] Implementar useMutation para salvar anotações ao clicar em "Salvar"
- [x] Adicionar loading states durante save/load
- [x] Mostrar toast de sucesso/erro após salvar
- [x] Testar persistência completa (salvar, fechar, reabrir)

## Gestão de Utilizadores - Registo da Equipa
- [x] Gerar passwords aleatórias seguras (12 caracteres) - N/A (OAuth)
- [x] Criar script para registar 7 utilizadores no banco de dados
- [x] Executar script e validar registos
- [x] Gerar documento com lista de credenciais (email + instruções OAuth)
- [x] Entregar lista ao utilizador

## Portal de Acesso da Equipa
- [x] Criar página HTML do portal de acesso
- [x] Design profissional com identidade Gavinho
- [x] Seção de utilizadores registados
- [x] Instruções passo a passo de login OAuth
- [x] Seção de funcionalidades disponíveis
- [x] Testar responsividade mobile/desktop
- [x] Deploy e validação

## Registo de Novos Utilizadores (Lote 2)
- [x] Registar 8 novos utilizadores no banco de dados
- [x] Atualizar portal TeamAccess com lista completa (15 membros)
- [x] Gerar documento atualizado de credenciais
- [x] Testar portal com lista expandida

## Melhorias de Navegação e Perfil
- [x] Adicionar botão "Portal da Equipa" no menu lateral do DashboardLayout
- [x] Criar página de perfil de utilizador (/profile)
- [x] Implementar formulário de edição de informações pessoais
- [ ] Adicionar upload de foto de perfil
- [ ] Criar sistema de notificações por email para novos registos
- [ ] Integrar envio de email de boas-vindas ao registar utilizador
- [ ] Testar fluxo completo de navegação e perfil

## Recursos Humanos (Admin Only)
- [x] Criar schema de banco de dados (holidays, absences, timesheets)
- [x] Adicionar calendário de feriados Portugal 2026
- [x] Implementar tRPC procedures para gestão de RH
- [x] Criar página /hr com controle de acesso admin
- [x] Tab "Equipa" - lista dos 15 membros com informações
- [x] Tab "Aprovações" - pedidos de ausência/férias pendentes
- [x] Tab "Gestão RH" - encerramento de feriados nacionais
- [x] Implementar sistema de pedidos de ausência
- [x] Criar interface de aprovação/rejeição de pedidos
- [x] Adicionar botão "Recursos Humanos" no menu lateral (admin only)
- [x] Dashboard de métricas RH (total equipa, pendentes, ausências, taxa aprovação)

## Formulário de Pedido de Ausência
- [x] Criar componente RequestAbsenceForm com seleção de datas
- [x] Adicionar dropdown de tipo de ausência (férias, doença, pessoal)
- [x] Campo de motivo/observações
- [x] Validação de datas (não permitir datas passadas, conflitos)
- [x] Integrar com hrRouter.absences.create
- [x] Adicionar botão "Solicitar Ausência" na página de perfil
- [x] Notificar administradores quando novo pedido é criado

## Página de Timesheets
- [x] Criar página Timesheets (/timesheets)
- [x] Formulário de registo de horas (data, projeto, horas, descrição)
- [x] Lista de timesheets do utilizador com filtros (data, projeto)
- [x] Tab de aprovação para gestores (pendentes, aprovados, rejeitados)
- [x] Implementar hrRouter.timesheets procedures (create, list, approve, reject)
- [ ] Botão de exportação para Excel/CSV
- [x] Adicionar item "Timesheets" no menu lateral
- [x] Dashboard de horas totais por projeto/mês com gráficos

## Relatórios RH Exportáveis
- [x] Criar página Reports (/hr-reports)
- [x] Relatório de ausências por colaborador (filtro período)
- [x] Relatório de ausências por departamento
- [ ] Relatório de timesheets por projeto
- [x] Implementar exportação PDF profissional com logotipos GAVINHO
- [x] Implementar exportação Excel/CSV usando export nativo
- [x] Adicionar gráficos de estatísticas (ausências/mês, horas/projeto)
- [x] Adicionar item "Relatórios RH" no menu lateral (admin only)


## Refatoração ArchViz - Associar Renders a Projetos
- [x] Modificar schema: adicionar projectId à tabela archviz_renders
- [x] Criar tabela archviz_compartments independente (não ligada a obras)
- [x] Atualizar archvizDb.ts para trabalhar com projectId
- [x] Modificar archvizRouter.ts para usar projetos ao invés de obras
- [x] Simplificar ProjectArchvizGallery.tsx removendo dropdown de obra
- [x] Criar sistema de compartimentos por projeto
- [x] Migrar dados existentes preservando renders
- [x] Testar upload e visualização de renders


## Sistema de Aprovação de Renders
- [x] Adicionar coluna `approvalStatus` à tabela archvizRenders (pending/in_review/approved/rejected)
- [x] Adicionar colunas `approvedBy` e `approvedAt` à tabela archvizRenders
- [x] Criar tabela `archvizRenderComments` para feedback
- [x] Criar tabela `archvizRenderHistory` para rastreamento de mudanças
- [x] Implementar procedures de aprovação/rejeição no archvizRouter
- [x] Implementar sistema de comentários no archvizRouter
- [ ] Criar notificações automáticas para mudanças de estado (futuro)
- [x] Adicionar badges de status na galeria de renders
- [x] Criar modal de aprovação com comentários
- [x] Implementar histórico de revisões na visualização de render
- [ ] Adicionar filtros por status de aprovação (futuro)
- [x] Testar workflow completo de aprovação


## Módulo de Gestão de Obra

### Schema e Backend
- [x] Criar tabela `siteWorkers` (trabalhadores em obra)
- [x] Criar tabela `siteAttendance` (picagem de ponto)
- [x] Criar tabela `siteWorkHours` (registo de horas trabalhadas)
- [x] Criar tabela `siteMaterialRequests` (requisição de materiais)
- [x] Criar tabela `siteMaterialUsage` (consumo de materiais)
- [x] Criar tabela `siteTools` (ferramentas)
- [x] Criar tabela `siteToolAssignments` (atribuição de ferramentas)
- [x] Criar tabela `siteToolMaintenance` (manutenção de ferramentas)
- [x] Criar tabela `siteWorkPhotos` (fotografias de trabalhos)
- [x] Criar tabela `siteIncidents` (ocorrências)
- [x] Criar tabela `siteSubcontractors` (subempreiteiros)
- [x] Criar tabela `siteSubcontractorWork` (trabalhos de subempreiteiros)
- [x] Criar tabela `siteVisits` (visitas à obra - direção/fiscalização)
- [x] Criar tabela `siteNonCompliances` (não conformidades)
- [x] Criar tabela `siteQuantityMap` (mapa de quantidades)
- [x] Criar tabela `siteQuantityProgress` (evolução de quantidades)
- [x] Criar tabela `siteSafetyAudits` (auditorias de segurança)
- [x] Criar tabela `siteSafetyIncidents` (acidentes/incidentes)
- [x] Criar tabela `sitePPE` (EPIs - Equipamentos de Proteção Individual)

### Funcionalidades - Trabalhadores
- [x] Implementar picagem de ponto (entrada/saída)
- [x] Sistema de registo de horas por tarefa
- [x] Requisição de materiais com aprovação
- [x] Registo de consumo de materiais
- [ ] Gestão de ferramentas atribuídas (futuro)
- [ ] Pedidos de manutenção/substituição (futuro)
- [x] Upload de fotografias diárias
- [ ] Registo de ocorrências (futuro)

### Funcionalidades - Subempreiteiros
- [ ] Registo de entrada/saída de obra
- [ ] Diário de trabalhos executados
- [ ] Upload de fotografias de progresso
- [ ] Gestão de equipa própria
- [ ] Relatórios de produtividade

### Funcionalidades - Direção de Obra
- [ ] Registo de visitas
- [ ] Geração automática de relatórios
- [ ] Gestão de não conformidades
- [ ] Atualização de mapa de quantidades
- [ ] Dashboard executivo de obra

### Funcionalidades - Fiscalização GAVINHO
- [ ] Registo de inspeções
- [ ] Checklist de conformidade
- [ ] Relatórios de fiscalização
- [ ] Validação de trabalhos

### Funcionalidades - Coordenação de Segurança
- [ ] Auditorias de segurança
- [ ] Registo de acidentes/incidentes
- [ ] Gestão de EPIs
- [ ] Planos de segurança

### Interface Web
- [ ] Página de gestão de trabalhadores
- [ ] Dashboard de picagem de ponto
- [ ] Gestão de materiais e ferramentas
- [ ] Painel de não conformidades
- [ ] Relatórios automáticos
- [ ] Dashboard de segurança

### API Mobile
- [ ] Endpoints otimizados para mobile
- [ ] Autenticação mobile
- [ ] Upload de fotografias otimizado
- [ ] Sincronização offline
